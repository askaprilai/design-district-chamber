<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Easy Quiz Builder - Quiz for Profits</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            line-height: 1.6;
            color: #1e293b;
        }

        .header {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            text-align: center;
        }

        .header h1 {
            color: #1e3a8a;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #64748b;
            font-size: 1.1rem;
        }

        .container {
            max-width: 900px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .quiz-info {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .quiz-info h2 {
            color: #1e3a8a;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .info-input {
            width: 100%;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .info-input:focus {
            outline: none;
            border-color: #1e3a8a;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .ai-section {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .ai-section h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .ai-section p {
            font-size: 1.1rem;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .ai-prompt {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 100px;
            resize: vertical;
            font-size: 1rem;
        }

        .ai-button {
            background: rgba(255, 255, 255, 0.9);
            color: #6366f1;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ai-button:hover {
            background: white;
            transform: translateY(-2px);
        }

        .ai-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .questions-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .questions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .questions-header h2 {
            color: #1e3a8a;
            font-size: 1.5rem;
        }

        .question-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            position: relative;
        }

        .question-number {
            background: #1e3a8a;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .question-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1rem;
            font-weight: 500;
        }

        .answer-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .answer-letter {
            background: #e2e8f0;
            color: #475569;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 12px;
            font-size: 0.9rem;
        }

        .answer-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            margin-right: 10px;
        }

        .score-input {
            width: 60px;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            text-align: center;
        }

        .delete-question {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ef4444;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
        }

        .add-question-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .add-question-btn:hover {
            background: #059669;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .publish-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .publish-button {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .publish-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.3);
        }

        .suggestions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .suggestion {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .suggestion:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .suggestion.selected {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transform: scale(1.02);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .title-suggestions {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .title-option {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px 15px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title-option:hover {
            border-color: #6366f1;
            background: #f0f0ff;
        }

        .title-option .title-text {
            font-weight: 500;
            color: #1e293b;
        }

        .title-option .title-type {
            font-size: 0.8rem;
            color: #64748b;
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .generate-more {
            text-align: center;
            margin-top: 10px;
        }

        .generate-more button {
            background: none;
            border: 1px dashed #cbd5e1;
            border-radius: 6px;
            padding: 8px 16px;
            color: #64748b;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .generate-more button:hover {
            border-color: #6366f1;
            color: #6366f1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .quiz-info, .ai-section, .questions-section, .publish-section {
                padding: 20px;
            }
            
            .suggestions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Easy Quiz Builder</h1>
        <p>Create professional quizzes in minutes with AI assistance</p>
    </div>

    <div class="container">
        <!-- Quiz Information -->
        <div class="quiz-info">
            <h2>📝 Quiz Details</h2>
            <div style="position: relative;">
                <input type="text" class="info-input" id="quizTitle" placeholder="Enter your quiz title..." value="">
                <button type="button" id="generateTitlesBtn" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: #6366f1; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                    ✨ Generate Titles
                </button>
            </div>
            <div id="titleSuggestions" style="display: none; margin-top: 10px;"></div>
            <textarea class="info-input" id="quizDescription" rows="3" placeholder="Describe what your quiz does..."></textarea>
        </div>

        <!-- AI Generation Section -->
        <div class="ai-section">
            <h2>🤖 AI Quiz Generator</h2>
            <p>Tell us about your quiz and we'll create professional questions for you!</p>
            
            <div class="suggestions">
                <div class="suggestion" onclick="fillSuggestion('Leadership assessment for managers')">
                    💼 Leadership Assessment
                </div>
                <div class="suggestion" onclick="fillSuggestion('Marketing skills evaluation for small business')">
                    📈 Marketing Skills Quiz
                </div>
                <div class="suggestion" onclick="fillSuggestion('Time management quiz for entrepreneurs')">
                    ⏰ Time Management Quiz
                </div>
                <div class="suggestion" onclick="fillSuggestion('Customer service skills assessment')">
                    🤝 Customer Service Quiz
                </div>
                <div class="suggestion" onclick="fillSuggestion('Sales skills diagnostic for entrepreneurs')">
                    💰 Sales Skills Quiz
                </div>
                <div class="suggestion" onclick="fillSuggestion('Productivity habits assessment')">
                    ⚡ Productivity Quiz
                </div>
            </div>

            <textarea class="ai-prompt" id="aiPrompt" placeholder="Example: 'Create a quiz to help coaches identify their biggest challenge with client retention and give them personalized advice'"></textarea>
            
            <button class="ai-button" id="generateBtn">
                ✨ Generate My Quiz Questions
            </button>
        </div>

        <!-- Questions Section -->
        <div class="questions-section">
            <div class="questions-header">
                <h2>📋 Your Questions</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="add-question-btn" onclick="addBlankQuestion()">+ Add Question</button>
                    <button class="add-question-btn" onclick="testQuestionGeneration()" style="background: #f59e0b;">🧪 Test</button>
                </div>
            </div>
            
            <div id="questionsList">
                <div class="empty-state">
                    <h3>No questions yet</h3>
                    <p>Use the AI generator above or click "Add Question" to get started</p>
                </div>
            </div>
        </div>

        <!-- Publish Section -->
        <div class="publish-section">
            <h2>🚀 Ready to Launch?</h2>
            <p style="margin-bottom: 25px; color: #64748b;">Your quiz will be ready to capture leads and grow your business</p>
            <button class="publish-button" onclick="publishQuiz()">Publish My Quiz</button>
        </div>
    </div>

    <script>
        let questions = [];
        let questionCounter = 0;

        // Check for generated quiz data from simple creator
        document.addEventListener('DOMContentLoaded', function() {
            const generatedQuiz = localStorage.getItem('generatedQuiz');
            if (generatedQuiz) {
                const quizData = JSON.parse(generatedQuiz);
                loadGeneratedQuiz(quizData);
                localStorage.removeItem('generatedQuiz'); // Clear after loading
            }
            
            // Add event listener for generate titles button
            const generateTitlesBtn = document.getElementById('generateTitlesBtn');
            if (generateTitlesBtn) {
                generateTitlesBtn.addEventListener('click', function() {
                    console.log('Generate Titles button clicked');
                    generateTitles();
                });
            }
            
            // Add event listener for AI generate button
            const generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                generateBtn.addEventListener('click', function() {
                    console.log('Generate Quiz button clicked');
                    generateQuiz();
                });
            }
        });

        function fillSuggestion(text) {
            const promptArea = document.getElementById('aiPrompt');
            const suggestions = document.querySelectorAll('.suggestion');
            
            // Clear previous selections
            suggestions.forEach(s => s.classList.remove('selected'));
            
            // Mark clicked suggestion as selected
            event.target.classList.add('selected');
            
            // Fill the prompt with animation
            promptArea.style.transform = 'scale(1.02)';
            promptArea.value = text;
            
            // Auto-generate quiz title preview
            const topic = extractTopic(text);
            if (!document.getElementById('quizTitle').value.trim()) {
                const titlePreview = generateQuizTitle(text);
                document.getElementById('quizTitle').value = titlePreview;
                document.getElementById('quizTitle').style.background = '#f0f9ff';
                setTimeout(() => {
                    document.getElementById('quizTitle').style.background = '';
                }, 1000);
            }
            
            // Reset prompt area animation
            setTimeout(() => {
                promptArea.style.transform = '';
            }, 200);
            
            // Show success message
            showNotification('✅ Great choice! Click "Generate My Quiz Questions" when ready.');
        }
        
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
                z-index: 1000;
                font-weight: 500;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            // Add slide-in animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function loadGeneratedQuiz(quizData) {
            // Fill in quiz details
            document.getElementById('quizTitle').value = quizData.title;
            document.getElementById('quizDescription').value = quizData.description;

            // Clear existing questions and load generated ones
            questions = [];
            questionCounter = 0;

            quizData.questions.forEach(q => {
                addQuestion(q.question, q.answers);
            });

            // Scroll to questions section
            document.querySelector('.questions-section').scrollIntoView({ behavior: 'smooth' });
        }

        async function generateQuiz() {
            const prompt = document.getElementById('aiPrompt').value.trim();
            if (!prompt) {
                showNotification('⚠️ Please describe your quiz topic first!', 'warning');
                document.getElementById('aiPrompt').focus();
                document.getElementById('aiPrompt').style.border = '2px solid #ef4444';
                setTimeout(() => {
                    document.getElementById('aiPrompt').style.border = '';
                }, 2000);
                return;
            }

            const btn = document.getElementById('generateBtn');
            const originalText = btn.innerHTML;
            
            // Show progressive loading states
            const loadingMessages = [
                '🤖 Analyzing your topic...',
                '✍️ Writing questions...',
                '🎯 Creating answer options...',
                '📊 Setting up scoring...',
                '✨ Almost ready!'
            ];
            
            let messageIndex = 0;
            btn.disabled = true;
            
            const loadingInterval = setInterval(() => {
                btn.innerHTML = loadingMessages[messageIndex];
                messageIndex = (messageIndex + 1) % loadingMessages.length;
            }, 600);

            try {
                // Show progress notification
                showNotification('🚀 Generating your quiz questions...', 'info');
                
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                const generatedQuestions = await createAIQuestions(prompt);
                
                // Clear existing questions properly
                questions = [];
                questionCounter = 0;
                const questionsList = document.getElementById('questionsList');
                questionsList.innerHTML = '';
                
                // Add generated questions with animation
                for (let i = 0; i < generatedQuestions.length; i++) {
                    setTimeout(() => {
                        addQuestion(generatedQuestions[i].question, generatedQuestions[i].answers);
                        
                        // Show completion message after last question
                        if (i === generatedQuestions.length - 1) {
                            showNotification(`🎉 Created ${generatedQuestions.length} professional questions!`, 'success');
                        }
                    }, i * 300);
                }

                // Auto-fill quiz title if empty
                if (!document.getElementById('quizTitle').value.trim()) {
                    const newTitle = generateQuizTitle(prompt);
                    document.getElementById('quizTitle').value = newTitle;
                    document.getElementById('quizTitle').style.background = '#f0f9ff';
                    setTimeout(() => {
                        document.getElementById('quizTitle').style.background = '';
                    }, 1500);
                }

                // Auto-fill description if empty
                if (!document.getElementById('quizDescription').value.trim()) {
                    document.getElementById('quizDescription').value = generateQuizDescription();
                }

                // Scroll to questions with delay
                setTimeout(() => {
                    document.querySelector('.questions-section').scrollIntoView({ behavior: 'smooth' });
                }, 1000);

            } catch (error) {
                showNotification('❌ Failed to generate questions. Please try again.', 'error');
                console.error(error);
            } finally {
                // Reset button
                clearInterval(loadingInterval);
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
        
        function showNotification(message, type = 'success') {
            const colors = {
                success: { bg: 'linear-gradient(135deg, #10b981, #059669)', shadow: 'rgba(16, 185, 129, 0.3)' },
                warning: { bg: 'linear-gradient(135deg, #f59e0b, #d97706)', shadow: 'rgba(245, 158, 11, 0.3)' },
                error: { bg: 'linear-gradient(135deg, #ef4444, #dc2626)', shadow: 'rgba(239, 68, 68, 0.3)' },
                info: { bg: 'linear-gradient(135deg, #3b82f6, #2563eb)', shadow: 'rgba(59, 130, 246, 0.3)' }
            };
            
            const color = colors[type] || colors.success;
            
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color.bg};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px ${color.shadow};
                z-index: 1000;
                font-weight: 500;
                animation: slideIn 0.3s ease;
                max-width: 300px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        function generateTitles() {
            console.log('generateTitles function called');
            
            const prompt = document.getElementById('aiPrompt').value.trim();
            const currentTitle = document.getElementById('quizTitle').value.trim();
            
            // Show loading state
            const generateBtn = document.getElementById('generateTitlesBtn');
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '⏳ Generating...';
            generateBtn.disabled = true;
            
            // Use AI prompt if available, otherwise generate generic titles
            let topic;
            if (prompt) {
                topic = extractTopic(prompt);
            } else if (currentTitle) {
                topic = extractTopicFromTitle(currentTitle);
            } else {
                // Default topics if nothing is entered
                topic = 'Business';
                showNotification('💡 Try clicking a suggestion below or typing your quiz topic first for better titles!', 'info');
            }
            
            console.log('Using topic:', topic);
            
            // Simulate brief loading for better UX
            setTimeout(() => {
                const titles = createTitleSuggestions(topic, prompt);
                showTitleSuggestions(titles);
                
                // Reset button
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }, 800);
        }

        function createTitleSuggestions(topic, prompt = '') {
            const titleTemplates = {
                'What Style': [
                    `What's Your ${topic} Style?`,
                    `Discover Your ${topic} Approach`,
                    `What Kind of ${topic} Are You?`,
                    `Find Your ${topic} Personality`
                ],
                'Assessment': [
                    `${topic} Skills Assessment`,
                    `How Good Are You at ${topic}?`,
                    `Rate Your ${topic} Abilities`,
                    `${topic} Competency Quiz`
                ],
                'Problem/Challenge': [
                    `What's Your Biggest ${topic} Challenge?`,
                    `${topic} Problem Solver Quiz`,
                    `Identify Your ${topic} Roadblocks`,
                    `${topic} Challenge Diagnostic`
                ],
                'Next Steps': [
                    `What's Your Next ${topic} Move?`,
                    `${topic} Action Plan Generator`,
                    `Your ${topic} Roadmap Quiz`,
                    `Next Steps for ${topic} Success`
                ],
                'Level/Stage': [
                    `What Level ${topic} Are You?`,
                    `${topic} Maturity Assessment`,
                    `Where Are You in Your ${topic} Journey?`,
                    `${topic} Progress Evaluation`
                ]
            };

            // Create array of all titles with their categories
            const allTitles = [];
            Object.keys(titleTemplates).forEach(category => {
                titleTemplates[category].forEach(title => {
                    allTitles.push({
                        text: title,
                        type: category,
                        topic: topic
                    });
                });
            });

            // Shuffle and return 6 diverse titles
            const shuffled = allTitles.sort(() => 0.5 - Math.random());
            const diverse = [];
            const usedCategories = new Set();
            
            for (const title of shuffled) {
                if (diverse.length >= 6) break;
                if (!usedCategories.has(title.type) || diverse.length >= 3) {
                    diverse.push(title);
                    usedCategories.add(title.type);
                }
            }

            return diverse;
        }

        function extractTopicFromTitle(title) {
            // Extract topic from existing title
            const commonWords = ['what', 'your', 'the', 'how', 'are', 'you', 'at', 'quiz', 'assessment', 'style', 'kind', 'of'];
            const words = title.toLowerCase().split(/\s+/).filter(word => 
                !commonWords.includes(word) && word.length > 2 && !word.includes('?')
            );
            return words.slice(0, 2).join(' ') || 'Leadership';
        }

        function showTitleSuggestions(titles) {
            const container = document.getElementById('titleSuggestions');
            container.className = 'title-suggestions';
            container.style.display = 'block';
            
            container.innerHTML = `
                <h4 style="margin-bottom: 15px; color: #1e293b; font-size: 1rem;">🎯 Choose a catchy title:</h4>
                ${titles.map(title => `
                    <div class="title-option" onclick="selectTitle('${title.text.replace(/'/g, "\\'")}')">
                        <span class="title-text">${title.text}</span>
                        <span class="title-type">${title.type}</span>
                    </div>
                `).join('')}
                <div class="generate-more">
                    <button onclick="generateTitles()">🔄 Generate More Options</button>
                </div>
            `;
        }

        function selectTitle(title) {
            document.getElementById('quizTitle').value = title;
            document.getElementById('titleSuggestions').style.display = 'none';
            
            // Auto-generate description if empty
            if (!document.getElementById('quizDescription').value.trim()) {
                const description = generateQuizDescription(title);
                document.getElementById('quizDescription').value = description;
            }
        }

        function generateQuizDescription(title) {
            const descriptions = [
                `Take this quick assessment to discover personalized insights and actionable recommendations.`,
                `Answer a few simple questions to get your customized results and next steps.`,
                `Find out where you stand and get expert advice tailored to your situation.`,
                `Get personalized recommendations based on your unique answers and goals.`,
                `Discover your strengths and areas for improvement with this comprehensive assessment.`
            ];
            return descriptions[Math.floor(Math.random() * descriptions.length)];
        }

        function generateQuizTitle(prompt) {
            const topic = extractTopic(prompt);
            const templates = [
                `What's Your ${topic} Style?`,
                `Discover Your ${topic} Approach`,
                `${topic} Assessment Quiz`,
                `What Kind of ${topic} Are You?`
            ];
            return templates[Math.floor(Math.random() * templates.length)];
        }

        async function createAIQuestions(prompt) {
            // Generate 5 relevant questions based on the prompt
            const questions = [
                {
                    question: `When it comes to ${extractTopic(prompt)}, what's your biggest challenge?`,
                    answers: [
                        { text: "Finding the time to focus on it", score: 1 },
                        { text: "Knowing where to start", score: 2 },
                        { text: "Staying consistent", score: 3 },
                        { text: "Measuring results", score: 4 }
                    ]
                },
                {
                    question: `How do you currently approach ${extractTopic(prompt)}?`,
                    answers: [
                        { text: "I wing it and hope for the best", score: 1 },
                        { text: "I follow basic best practices", score: 2 },
                        { text: "I have a systematic approach", score: 3 },
                        { text: "I constantly test and optimize", score: 4 }
                    ]
                },
                {
                    question: `What's your experience level with ${extractTopic(prompt)}?`,
                    answers: [
                        { text: "Complete beginner", score: 1 },
                        { text: "Some experience", score: 2 },
                        { text: "Pretty experienced", score: 3 },
                        { text: "Expert level", score: 4 }
                    ]
                },
                {
                    question: `When you think about improving your ${extractTopic(prompt)}, you:`,
                    answers: [
                        { text: "Feel overwhelmed and don't know where to start", score: 1 },
                        { text: "Have some ideas but lack a clear plan", score: 2 },
                        { text: "Have a plan and are making progress", score: 3 },
                        { text: "Are already seeing great results", score: 4 }
                    ]
                },
                {
                    question: `Your goal for ${extractTopic(prompt)} is to:`,
                    answers: [
                        { text: "Just get started and learn the basics", score: 1 },
                        { text: "Build a solid foundation", score: 2 },
                        { text: "Take it to the next level", score: 3 },
                        { text: "Become a recognized expert", score: 4 }
                    ]
                }
            ];

            return questions;
        }

        function extractTopic(prompt) {
            // Extract the main topic from the prompt
            const words = prompt.toLowerCase().split(' ');
            const commonWords = ['create', 'quiz', 'help', 'identify', 'assessment', 'for', 'to', 'a', 'an', 'the', 'their', 'with'];
            const topicWords = words.filter(word => !commonWords.includes(word) && word.length > 3);
            return topicWords.slice(0, 2).join(' ') || 'this topic';
        }

        function addQuestion(questionText = '', answers = null) {
            console.log('Adding question:', questionText, answers); // Debug log
            
            questionCounter++;
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-card';
            questionDiv.dataset.questionId = questionCounter;

            const defaultAnswers = answers || [
                { text: '', score: 1 },
                { text: '', score: 2 },
                { text: '', score: 3 },
                { text: '', score: 4 }
            ];

            questionDiv.innerHTML = `
                <button class="delete-question" onclick="deleteQuestion(${questionCounter})">×</button>
                <div class="question-number">${questionCounter}</div>
                <input type="text" class="question-input" placeholder="Enter your question..." value="${questionText}">
                ${defaultAnswers.map((answer, index) => `
                    <div class="answer-item">
                        <div class="answer-letter">${String.fromCharCode(65 + index)}</div>
                        <input type="text" class="answer-input" placeholder="Answer option ${String.fromCharCode(65 + index)}" value="${answer.text}">
                        <input type="number" class="score-input" value="${answer.score}" min="0" max="10" title="Points for this answer">
                    </div>
                `).join('')}
            `;

            // Remove empty state if it exists
            const emptyState = document.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
                console.log('Removed empty state'); // Debug log
            }

            const questionsList = document.getElementById('questionsList');
            if (questionsList) {
                questionsList.appendChild(questionDiv);
                console.log('Question added to DOM'); // Debug log
            } else {
                console.error('questionsList not found!');
            }

            questions.push({
                id: questionCounter,
                question: questionText,
                answers: defaultAnswers
            });
            
            // Add some visual feedback
            questionDiv.style.opacity = '0';
            questionDiv.style.transform = 'translateY(20px)';
            setTimeout(() => {
                questionDiv.style.transition = 'all 0.5s ease';
                questionDiv.style.opacity = '1';
                questionDiv.style.transform = 'translateY(0)';
            }, 100);
        }

        function testQuestionGeneration() {
            console.log('Testing question generation...');
            
            // Clear existing questions
            questions = [];
            questionCounter = 0;
            const questionsList = document.getElementById('questionsList');
            questionsList.innerHTML = '';
            
            // Add a test question
            const testQuestion = {
                question: "What's your biggest challenge with leadership?",
                answers: [
                    { text: "Finding time for team development", score: 1 },
                    { text: "Making difficult decisions", score: 2 },
                    { text: "Communicating vision effectively", score: 3 },
                    { text: "Managing different personalities", score: 4 }
                ]
            };
            
            addQuestion(testQuestion.question, testQuestion.answers);
            showNotification('🧪 Test question added successfully!', 'success');
        }

        function addBlankQuestion() {
            addQuestion();
            // Scroll to the new question
            setTimeout(() => {
                const newQuestion = document.querySelector(`[data-question-id="${questionCounter}"]`);
                newQuestion.scrollIntoView({ behavior: 'smooth', block: 'center' });
                newQuestion.querySelector('.question-input').focus();
            }, 100);
        }

        function deleteQuestion(questionId) {
            if (confirm('Are you sure you want to delete this question?')) {
                document.querySelector(`[data-question-id="${questionId}"]`).remove();
                questions = questions.filter(q => q.id !== questionId);
                
                // Show empty state if no questions left
                if (questions.length === 0) {
                    document.getElementById('questionsList').innerHTML = `
                        <div class="empty-state">
                            <h3>No questions yet</h3>
                            <p>Use the AI generator above or click "Add Question" to get started</p>
                        </div>
                    `;
                }
            }
        }

        function publishQuiz() {
            const title = document.getElementById('quizTitle').value.trim();
            const description = document.getElementById('quizDescription').value.trim();

            if (!title) {
                alert('Please enter a quiz title!');
                document.getElementById('quizTitle').focus();
                return;
            }

            if (questions.length === 0) {
                alert('Please add at least one question!');
                return;
            }

            // Collect all question data
            const questionElements = document.querySelectorAll('.question-card');
            const quizData = {
                title: title,
                description: description,
                questions: []
            };

            questionElements.forEach((element, index) => {
                const questionText = element.querySelector('.question-input').value.trim();
                const answerInputs = element.querySelectorAll('.answer-input');
                const scoreInputs = element.querySelectorAll('.score-input');

                if (questionText) {
                    const answers = [];
                    answerInputs.forEach((input, answerIndex) => {
                        if (input.value.trim()) {
                            answers.push({
                                text: input.value.trim(),
                                score: parseInt(scoreInputs[answerIndex].value) || 0
                            });
                        }
                    });

                    if (answers.length > 0) {
                        quizData.questions.push({
                            question: questionText,
                            answers: answers
                        });
                    }
                }
            });

            if (quizData.questions.length === 0) {
                alert('Please add some questions and answers!');
                return;
            }

            // Generate HTML file
            const quizHTML = generateQuizHTML(quizData);
            downloadQuiz(quizHTML, title);
            
            alert(`🎉 Quiz "${title}" published successfully! The HTML file has been downloaded. Upload it to your website to start capturing leads!`);
        }

        function generateQuizHTML(quizData) {
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${quizData.title}</title>
    <style>
        /* Modern quiz styling similar to money leak quiz */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            min-height: 100vh; 
            padding: 20px; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            padding: 40px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
        }
        .question { display: none; }
        .question.active { display: block; }
        .question h2 { color: #1e3a8a; margin-bottom: 20px; font-size: 1.5rem; }
        .answers { margin: 30px 0; }
        .answer { 
            background: #f8fafc; 
            border: 2px solid #e2e8f0; 
            border-radius: 12px; 
            padding: 15px; 
            margin: 15px 0; 
            cursor: pointer; 
            transition: all 0.3s; 
        }
        .answer:hover { border-color: #1e3a8a; background: #eff6ff; }
        .answer.selected { border-color: #1e3a8a; background: #eff6ff; }
        .nav-buttons { text-align: center; margin-top: 30px; }
        .btn { 
            background: #1e3a8a; 
            color: white; 
            border: none; 
            padding: 12px 25px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 0 10px; 
            font-size: 1rem;
        }
        .btn:hover { background: #1e40af; }
        .btn:disabled { background: #cbd5e1; cursor: not-allowed; }
        .results { display: none; text-align: center; }
        .results.active { display: block; }
        .score { font-size: 3rem; color: #1e3a8a; font-weight: bold; margin: 20px 0; }
        .email-form { background: #f8fafc; padding: 30px; border-radius: 15px; margin: 30px 0; }
        .email-form input { width: 100%; padding: 15px; border: 1px solid #e2e8f0; border-radius: 8px; margin: 10px 0; }
        .cta-button { background: #1e3a8a; color: white; padding: 15px 30px; border: none; border-radius: 10px; font-size: 1.1rem; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #1e3a8a; margin-bottom: 30px;">${quizData.title}</h1>
        <p style="text-align: center; color: #64748b; margin-bottom: 40px;">${quizData.description}</p>
        
        <div id="quiz">
            ${quizData.questions.map((q, index) => `
                <div class="question ${index === 0 ? 'active' : ''}" data-question="${index + 1}">
                    <h2>Question ${index + 1}: ${q.question}</h2>
                    <div class="answers">
                        ${q.answers.map((a, aIndex) => `
                            <div class="answer" onclick="selectAnswer(${index + 1}, ${a.score}, this)">
                                ${a.text}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('')}
        </div>
        
        <div class="nav-buttons">
            <button class="btn" id="prevBtn" onclick="previousQuestion()" disabled>Previous</button>
            <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>Next</button>
        </div>
        
        <div class="results" id="results">
            <h2>Your Results</h2>
            <div class="score" id="finalScore"></div>
            <p id="scoreDescription"></p>
            
            <div class="email-form">
                <h3>Get Your Personalized Report</h3>
                <input type="text" id="userName" placeholder="Your Name" required>
                <input type="email" id="userEmail" placeholder="Your Email" required>
                <button class="cta-button" onclick="submitEmail()">Get My Free Report</button>
            </div>
        </div>
    </div>
    
    <script>
        let currentQuestion = 1;
        let totalQuestions = ${quizData.questions.length};
        let answers = {};
        let totalScore = 0;
        
        function selectAnswer(questionNum, score, element) {
            // Remove selection from other answers
            element.parentNode.querySelectorAll('.answer').forEach(a => a.classList.remove('selected'));
            element.classList.add('selected');
            
            // Store answer
            answers[questionNum] = score;
            document.getElementById('nextBtn').disabled = false;
        }
        
        function nextQuestion() {
            if (currentQuestion < totalQuestions) {
                document.querySelector('[data-question="' + currentQuestion + '"]').classList.remove('active');
                currentQuestion++;
                document.querySelector('[data-question="' + currentQuestion + '"]').classList.add('active');
                updateButtons();
            } else {
                showResults();
            }
        }
        
        function previousQuestion() {
            if (currentQuestion > 1) {
                document.querySelector('[data-question="' + currentQuestion + '"]').classList.remove('active');
                currentQuestion--;
                document.querySelector('[data-question="' + currentQuestion + '"]').classList.add('active');
                updateButtons();
            }
        }
        
        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentQuestion === 1;
            document.getElementById('nextBtn').disabled = !answers[currentQuestion];
            document.getElementById('nextBtn').textContent = currentQuestion === totalQuestions ? 'Get Results' : 'Next';
        }
        
        function showResults() {
            totalScore = Object.values(answers).reduce((sum, score) => sum + score, 0);
            const maxScore = totalQuestions * 4;
            const percentage = Math.round((totalScore / maxScore) * 100);
            
            document.getElementById('quiz').style.display = 'none';
            document.querySelector('.nav-buttons').style.display = 'none';
            document.getElementById('results').classList.add('active');
            document.getElementById('finalScore').textContent = percentage + '%';
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        function submitEmail() {
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;
            
            if (!name || !email) {
                alert('Please enter your name and email');
                return;
            }
            
            // Here you would integrate with your email service
            alert('Thank you! Your personalized report has been sent to ' + email);
        }
    </script>
</body>
</html>`;
        }

        function downloadQuiz(html, title) {
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = title.toLowerCase().replace(/[^a-z0-9]/g, '-') + '-quiz.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>