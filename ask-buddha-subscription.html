<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Buddha - AI Life Coach</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1000px;
            padding: 40px;
            backdrop-filter: blur(10px);
        }

        .subscription-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .subscription-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .pricing-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .price {
            font-size: 3em;
            font-weight: bold;
            color: #4a5568;
            margin: 20px 0;
        }

        .price-period {
            font-size: 0.4em;
            color: #718096;
        }

        .features-list {
            text-align: left;
            margin: 30px 0;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
            color: #4a5568;
        }

        .feature-icon {
            color: #667eea;
            margin-right: 10px;
            font-weight: bold;
        }

        .subscribe-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            width: 100%;
            margin: 20px 0;
            transition: transform 0.2s ease;
        }

        .subscribe-btn:hover {
            transform: translateY(-2px);
        }

        .trial-info {
            color: #718096;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .usage-counter {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            color: #856404;
        }

        .upgrade-banner {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .upgrade-btn {
            background: white;
            color: #ee5a24;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .buddha-icon {
            font-size: 4em;
            margin-bottom: 10px;
            display: block;
            animation: gentle-pulse 3s ease-in-out infinite;
        }

        @keyframes gentle-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        h1 {
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .subtitle {
            color: #718096;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .quote-of-the-day {
            background: linear-gradient(135deg, rgba(255, 216, 155, 0.2) 0%, rgba(25, 84, 123, 0.2) 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            border-left: 4px solid #ffd89b;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .quote-of-the-day:hover {
            transform: translateY(-2px);
        }

        .quote-text {
            font-style: italic;
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .quote-author {
            color: #718096;
            font-weight: 600;
        }

        .chat-container {
            background: #f7fafc;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            opacity: 0;
            animation: fadeInUp 0.5s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .message.buddha .message-avatar {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message-content {
            background: white;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 70%;
            line-height: 1.6;
            position: relative;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message-time {
            font-size: 0.8em;
            color: #a0aec0;
            margin-top: 5px;
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .input-container {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        #questionInput {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
            resize: none;
            min-height: 50px;
            max-height: 120px;
            font-family: inherit;
        }

        #questionInput:focus {
            border-color: #667eea;
        }

        #askButton {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease;
            min-width: 100px;
        }

        #askButton:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        #askButton:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .welcome-message {
            text-align: center;
            color: #718096;
            font-style: italic;
            margin: 40px 0;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            color: #718096;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: #718096;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .testimonials {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .testimonial {
            font-style: italic;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .testimonial-author {
            color: #718096;
            font-size: 0.9em;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .subscription-content {
                padding: 30px 20px;
            }

            h1 {
                font-size: 2em;
            }

            .message-content {
                max-width: 85%;
            }

            .input-container {
                flex-direction: column;
                align-items: stretch;
            }

            #askButton {
                margin-top: 10px;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <span class="buddha-icon">🧘‍♂️</span>
            <h1>Ask Buddha</h1>
            <p class="subtitle">Your AI Life Coach for Wisdom and Inner Peace</p>
        </div>

        <!-- Usage Counter for Free Users -->
        <div class="usage-counter" id="usageCounter" style="display: none;">
            <strong>Free Trial:</strong> <span id="messagesLeft">3</span> questions remaining
        </div>

        <!-- Upgrade Banner -->
        <div class="upgrade-banner" id="upgradeBanner" style="display: none;">
            <div><strong>🚀 You've used all your free questions!</strong></div>
            <div>Unlock unlimited wisdom for just $1/month</div>
            <button class="upgrade-btn" onclick="showSubscriptionModal()">Upgrade Now</button>
        </div>

        <div class="quote-of-the-day" onclick="getNewQuote()">
            <div class="quote-text" id="quoteText">"The mind is everything. What you think you become."</div>
            <div class="quote-author" id="quoteAuthor">- Buddha</div>
            <small style="color: #a0aec0; margin-top: 10px; display: block;">Click for new quote</small>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="welcome-message">
                Welcome, seeker of wisdom. I am here to guide you with ancient Buddhist teachings and modern insights. What weighs on your mind today?
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="message-avatar" style="background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); color: white;">🧘‍♂️</div>
            <div>Buddha is reflecting...</div>
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <div class="input-container">
            <textarea id="questionInput" placeholder="Ask about life, relationships, work stress, mindfulness, or any challenge you're facing..." rows="1"></textarea>
            <button id="askButton" onclick="askBuddha()">Ask Buddha</button>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div class="subscription-modal" id="subscriptionModal" style="display: none;">
        <div class="subscription-content">
            <button class="close-modal" onclick="hideSubscriptionModal()">×</button>
            
            <div class="pricing-badge">🧘‍♂️ PREMIUM WISDOM</div>
            
            <h2 style="color: #4a5568; margin-bottom: 20px;">Unlock Unlimited Buddha Wisdom</h2>
            
            <div class="price">
                $1<span class="price-period">/month</span>
            </div>
            
            <div class="features-list">
                <div class="feature-item">
                    <span class="feature-icon">✨</span>
                    Unlimited questions and wisdom sessions
                </div>
                <div class="feature-item">
                    <span class="feature-icon">🧘‍♂️</span>
                    Guided meditation timer with bells
                </div>
                <div class="feature-item">
                    <span class="feature-icon">📖</span>
                    Daily personalized wisdom quotes
                </div>
                <div class="feature-item">
                    <span class="feature-icon">💾</span>
                    Save and export your wisdom journey
                </div>
                <div class="feature-item">
                    <span class="feature-icon">🎯</span>
                    Mood tracking and personalized guidance
                </div>
                <div class="feature-item">
                    <span class="feature-icon">🌟</span>
                    Priority access to new features
                </div>
            </div>
            
            <div class="testimonials">
                <div class="testimonial">"Ask Buddha has transformed my daily stress into moments of peace. Worth every penny!"</div>
                <div class="testimonial-author">- Sarah M., Marketing Manager</div>
            </div>
            
            <button class="subscribe-btn" onclick="initiateSubscription()">
                Start Your Wisdom Journey - $1/month
            </button>
            
            <div class="trial-info">
                Cancel anytime • Secure payment • Instant access
            </div>
        </div>
    </div>

    <script>
        // Subscription and usage tracking
        let isSubscribed = localStorage.getItem('buddha_subscribed') === 'true';
        let messagesUsed = parseInt(localStorage.getItem('buddha_messages_used') || '0');
        const freeMessageLimit = 3;
        
        // Stripe configuration (you'll need to add your publishable key)
        const stripe = Stripe('pk_test_your_stripe_publishable_key_here'); // Replace with your actual key

        const wisdomDatabase = {
            stress: [
                "Stress arises from attachment to outcomes. Focus on your effort, not the result. Like a river flowing around rocks, adapt to circumstances rather than resist them.",
                "When stress overwhelms you, return to your breath. Each inhale brings calm, each exhale releases tension. The present moment is your sanctuary.",
                "Stress is often fear of the future or regret of the past. Root yourself in now - this moment is the only reality you can truly influence."
            ],
            relationships: [
                "In relationships, seek first to understand, then to be understood. Love without expectation, like the sun that shines on all equally.",
                "Anger in relationships is like grasping a hot coal - you are the one who gets burned. Practice compassion, even when it's difficult.",
                "True intimacy comes from accepting others as they are, not as you wish them to be. Release the need to change others; change yourself."
            ],
            work: [
                "Approach your work as meditation in action. Each task, done with mindfulness and care, becomes a spiritual practice.",
                "Success at work comes not from ambition alone, but from finding purpose in service to others. Make your work a gift to the world.",
                "When work feels overwhelming, remember: you are not your job. You are consciousness experiencing work. This perspective brings freedom."
            ],
            anxiety: [
                "Anxiety is the mind's attempt to control the uncontrollable. Practice letting go, like leaves falling naturally from a tree.",
                "When anxiety arises, observe it with gentle curiosity. It is a cloud passing through the sky of your consciousness - temporary and not you.",
                "Ground yourself in your senses: What do you see, hear, feel right now? Anxiety lives in imagination; peace lives in presence."
            ],
            purpose: [
                "Your purpose is not a destination to reach, but a path to walk. Each step taken with awareness and compassion fulfills your purpose.",
                "Purpose emerges when you align your unique gifts with the world's needs. Look for where your joy meets others' suffering.",
                "You are already whole and complete. Purpose is not about becoming someone else, but about expressing who you truly are."
            ],
            mindfulness: [
                "Mindfulness is not about stopping thoughts, but about changing your relationship with them. Observe without judgment, like a scientist studying clouds.",
                "Each moment of mindfulness is a seed of awakening. Water these seeds daily through meditation, breath awareness, and present-moment attention.",
                "Mindfulness transforms ordinary activities into sacred rituals. Washing dishes becomes meditation, walking becomes prayer."
            ],
            fear: [
                "Fear is often excitement without breath. When fear arises, breathe deeply and ask: 'What would I do if I knew I could not fail?'",
                "Fear keeps you small, but you are vast like the sky. Clouds of fear will pass; your essential nature remains unchanging.",
                "Courage is not the absence of fear, but action in the presence of fear. Take one small step despite the trembling."
            ],
            happiness: [
                "Happiness is not a destination but a way of traveling. It comes not from getting what you want, but from appreciating what you have.",
                "True happiness arises from within, like a spring that never runs dry. External circumstances are just weather passing through your sky.",
                "Happiness shared is happiness doubled. Practice loving-kindness: may all beings be happy, may all beings be free from suffering."
            ]
        };

        const generalWisdom = [
            "Life is like a river - sometimes calm, sometimes turbulent. Your peace comes not from controlling the current, but from learning to flow with it.",
            "Every challenge is a teacher in disguise. Ask not 'Why is this happening to me?' but 'What is this here to teach me?'",
            "You are not your thoughts, emotions, or circumstances. You are the awareness experiencing them. This recognition is liberation.",
            "Compassion begins with yourself. Treat yourself with the same kindness you would show a dear friend facing your struggles.",
            "The present moment is the only moment where life exists. Past is memory, future is imagination. Reality is now.",
            "Peace is not the absence of conflict, but the presence of awareness. In awareness, all conflicts can be resolved with wisdom.",
            "Your suffering decreases when you realize that everything is impermanent. This too shall pass, whether pleasant or unpleasant.",
            "True strength lies not in resistance but in acceptance. Like bamboo, bend with the wind and you will not break."
        ];

        const quotes = [
            { text: "The mind is everything. What you think you become.", author: "Buddha" },
            { text: "Peace comes from within. Do not seek it without.", author: "Buddha" },
            { text: "You yourself, as much as anybody in the entire universe, deserve your love and affection.", author: "Buddha" },
            { text: "Three things cannot be long hidden: the sun, the moon, and the truth.", author: "Buddha" },
            { text: "The only way to make sense out of change is to plunge into it, move with it, and join the dance.", author: "Alan Watts" },
            { text: "Be present in all things and thankful for all things.", author: "Maya Angelou" },
            { text: "The quieter you become, the more able you are to hear.", author: "Rumi" }
        ];

        function initializeApp() {
            updateUsageDisplay();
            checkSubscriptionStatus();
        }

        function updateUsageDisplay() {
            const usageCounter = document.getElementById('usageCounter');
            const upgradeBanner = document.getElementById('upgradeBanner');
            const messagesLeft = freeMessageLimit - messagesUsed;

            if (isSubscribed) {
                usageCounter.style.display = 'none';
                upgradeBanner.style.display = 'none';
            } else if (messagesUsed >= freeMessageLimit) {
                usageCounter.style.display = 'none';
                upgradeBanner.style.display = 'block';
            } else {
                usageCounter.style.display = 'block';
                upgradeBanner.style.display = 'none';
                document.getElementById('messagesLeft').textContent = messagesLeft;
            }
        }

        function checkSubscriptionStatus() {
            // In a real app, you'd check with your backend
            if (isSubscribed) {
                console.log('User is subscribed');
            }
        }

        function canAskQuestion() {
            return isSubscribed || messagesUsed < freeMessageLimit;
        }

        function showSubscriptionModal() {
            document.getElementById('subscriptionModal').style.display = 'flex';
        }

        function hideSubscriptionModal() {
            document.getElementById('subscriptionModal').style.display = 'none';
        }

        async function initiateSubscription() {
            // In a real implementation, you would:
            // 1. Create a checkout session on your backend
            // 2. Redirect to Stripe Checkout
            // 3. Handle the success/failure callbacks
            
            // For demo purposes, we'll simulate a successful subscription
            alert('Redirecting to secure payment...\n\nIn a real app, this would open Stripe Checkout.');
            
            // Simulate successful subscription for demo
            setTimeout(() => {
                isSubscribed = true;
                localStorage.setItem('buddha_subscribed', 'true');
                hideSubscriptionModal();
                updateUsageDisplay();
                addMessage("🎉 Welcome to Premium Buddha Wisdom! You now have unlimited access to guidance and all premium features. Thank you for supporting mindful technology.", false);
            }, 2000);
        }

        function getRandomElement(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function getNewQuote() {
            const quote = getRandomElement(quotes);
            document.getElementById('quoteText').textContent = `"${quote.text}"`;
            document.getElementById('quoteAuthor').textContent = `- ${quote.author}`;
        }

        function findRelevantWisdom(question) {
            const lowerQuestion = question.toLowerCase();
            
            for (const [category, wisdom] of Object.entries(wisdomDatabase)) {
                if (lowerQuestion.includes(category) || 
                    (category === 'relationships' && (lowerQuestion.includes('partner') || lowerQuestion.includes('friend') || lowerQuestion.includes('family'))) ||
                    (category === 'work' && (lowerQuestion.includes('job') || lowerQuestion.includes('career') || lowerQuestion.includes('boss'))) ||
                    (category === 'anxiety' && (lowerQuestion.includes('worried') || lowerQuestion.includes('nervous'))) ||
                    (category === 'happiness' && (lowerQuestion.includes('joy') || lowerQuestion.includes('content'))) ||
                    (category === 'fear' && (lowerQuestion.includes('afraid') || lowerQuestion.includes('scared')))) {
                    return getRandomElement(wisdom);
                }
            }
            
            return getRandomElement(generalWisdom);
        }

        function addMessage(content, isUser = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'buddha'}`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${isUser ? '🙋‍♂️' : '🧘‍♂️'}</div>
                <div class="message-content">
                    ${content}
                    <div class="message-time">${timeString}</div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Remove welcome message if it exists
            const welcomeMessage = chatContainer.querySelector('.welcome-message');
            if (welcomeMessage) {
                welcomeMessage.remove();
            }
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        async function askBuddha() {
            const input = document.getElementById('questionInput');
            const button = document.getElementById('askButton');
            const question = input.value.trim();
            
            if (!question) return;

            // Check if user can ask questions
            if (!canAskQuestion()) {
                showSubscriptionModal();
                return;
            }
            
            // Disable input and button
            input.disabled = true;
            button.disabled = true;
            
            // Add user message
            addMessage(question, true);
            
            // Increment usage for free users
            if (!isSubscribed) {
                messagesUsed++;
                localStorage.setItem('buddha_messages_used', messagesUsed.toString());
                updateUsageDisplay();
            }
            
            // Clear input
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate thinking time
            await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 2000));
            
            // Hide typing indicator
            hideTypingIndicator();
            
            // Get wisdom response
            const wisdom = findRelevantWisdom(question);
            addMessage(wisdom);
            
            // Re-enable input and button
            input.disabled = false;
            button.disabled = false;
            input.focus();

            // Show subscription prompt if user is near limit
            if (!isSubscribed && messagesUsed === freeMessageLimit - 1) {
                setTimeout(() => {
                    addMessage("🌟 You have one more free question remaining. Consider subscribing for unlimited wisdom guidance at just $1/month to continue your journey of growth and mindfulness.", false);
                }, 1000);
            }
        }

        // Auto-resize textarea
        document.getElementById('questionInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Enter key to submit (Shift+Enter for new line)
        document.getElementById('questionInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                askBuddha();
            }
        });

        // Initialize app when page loads
        window.addEventListener('load', function() {
            initializeApp();
            document.getElementById('questionInput').focus();
        });

        // Close modal when clicking outside
        document.getElementById('subscriptionModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideSubscriptionModal();
            }
        });
    </script>
</body>
</html>